<% content_for :page_head do %>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
  <link rel="stylesheet" href="http://tablesorter.com/themes/blue/style.css" />
  <script type="text/javascript" src="http://autobahn.tablesorter.com/jquery.tablesorter.min.js"></script>
  <script type="text/javascript" src="http://tablesorter.com/addons/pager/jquery.tablesorter.pager.js"></script>
  <script src="11http://www.openfoundry.org/of/javascripts/jquery.tablesorter.js" type="text/javascript"></script>
  <script src="11http://www.openfoundry.org/of/javascripts/jquery.tablesorter.pager.js" type="text/javascript"></script>
  <script type="text/javascript" src="/of/yoxview/yoxview-init.js"></script>
<% end %>
<% content_for :ujs do %>
  $.noConflict();
  var pp = 0;
  (function($){
    $(document).ready(function() {
      $("#wiki_list_check_box_all").click(function(){
        if($(this).attr('checked') == 'checked')
        {
          jQuery.each($('[name="files[]"]'), function() {
            $(this).attr('checked', 'checked');
          });
        }
        else
        {
          jQuery.each($('[name="files[]"]'), function() {
            $(this).removeAttr('checked');
          });
        }
      });

      $(":submit[name='delete']").click(function(){
        if($(':checkbox[name="files[]"]:checked').length == 0){
          alert('<%= t('No selected items.') %>');
          return false;
        }
      });

      $("table")
        .tablesorter({widthFixed:true, widgets:['zebra'], headers:{0:{sorter:false}, 2:{sorter:false}}})
        .tablesorterPager({container: $("#pager"), size:10, positionFixed:false});
      $(".yoxview").yoxview();
    });
  })(jQuery);
<% end %>

<h2><%= t('Files List') %></h2>

<%= render :partial => "functions" %>
<hr/>

<%= t('Upload files') %>:
<%= form_tag({:action => 'web_upload'}, :multipart => true) do %>
  <%# form_tag ({:project_id => @project.id, :id => @release.id, :action => 'web_upload'}, :multipart => true) do %>
  <% for i in 1..3 %>
    <%= file_field_tag("upload_file[]") %><br/>
  <% end %>
  <%= submit_tag t('Upload') %>
  <%= submit_tag t('Reset'), :type => 'reset' %> 
<% end %>

<%= form_tag({:action => 'delete_files'}) do %>
  </div>
  <table class="tablesorter yoxview">
    <thead>
      <th style="width:15px"><input type="checkbox" id="wiki_list_check_box_all"></th>
      <th><%= t('File Name') %></th>
      <th><%= t('File Size') %></th>
      <th><%= t('Upload Date') %></th>
      <th><%= t('Image Size') %></th>
      <th><%= t('Image Preview') %></th>
    </thead>
  <% @files.each do |f| -%>
    <tr>
      <td><%= check_box_tag "files[]", f[:name] %></td>
      <td><%= f[:name] %></td>
      <td><%= number_to_human_size(f[:size]) %></td>
      <td><%= tz_datetime(f[:mtime]) %></td>
      <td><%= f[:imagesize] %></td>
      <td>
        <% if f[:name].to_s =~ /\.(jpg|jpeg|gif|bmp|png|ico)$/ -%>
          <a href="<%= "/of/wiki_upload/#{params[:project_id]}/#{f[:name]}" %>">
            <img src="<%= "/of/wiki_upload/#{params[:project_id]}/small/#{f[:name]}" %>" />
          </a>
        <% end -%> 
      </td>
    </tr>
  <% end -%>
  </table>
  <div id="pager" class="pager">
    <img src="http://tablesorter.com/addons/pager/icons/first.png" class="first"/>
    <img src="http://tablesorter.com/addons/pager/icons/prev.png" class="prev"/>
    <input type="text" class="pagedisplay" readonly="true"/>
    <img src="http://tablesorter.com/addons/pager/icons/next.png" class="next"/>
    <img src="http://tablesorter.com/addons/pager/icons/last.png" class="last"/>
    <select class="pagesize">
      <option selected="selected"  value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
      <option value="100">100</option>
      <option value="200">200</option>
    </select>
  </div>
  <%= submit_tag t('Delete'), :name => 'delete', :confirm => t('Are you sure?') %>
<% end %>

<hr/>
<%= render :partial => "functions" %>
